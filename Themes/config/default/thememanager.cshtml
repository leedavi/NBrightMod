@inherits NBrightMod.render.NBrightModRazorTokens<NBrightDNN.NBrightRazor>
@using System.Linq
@using System.Web.UI.HtmlControls
@using NBrightDNN



@AddMetaData("resourcepath","/DesktopModules/NBright/NBrightMod/App_LocalResources/")

@{
    var info = (NBrightInfo)Model.List.First();
    var tabid = Model.GetUrlParam("tabid");
}
<input id="exiturl" type="hidden" value="//@WebsiteUrl("tabid=" + tabid + "&language=" + @Model.GetUrlParam("language"))"></input>

<div id="nbrightmodtools">

    <div id="nbrightmodthemedata">
        <input id="moduleid" type="hidden" value="@info.ModuleId"/>
        <input id="updatetype" type="hidden" value=""/>
        <input id="templfilename" type="hidden" value="@info.GetXmlProperty("genxml/templfilename")" />  
        <input id="resxfilename" type="hidden" value="@info.GetXmlProperty("genxml/resxfilename")" />
        

        <div>
            <button id='exitedit' type='button' class='btn btn-default'><span class='glyphicon glyphicon-log-out'></span>@ResourceKey("Edit.exit")</button>
        </div>
        <hr />

        <div id="optionselectdiv">
            <div id="step1">
                <div class='buttons'>
                    <button id='edittheme' type='button' class='btn btn-success'><span class='glyphicon glyphicon-pencil'></span>@ResourceKey("Edit.edittheme")</button>
                    @DnnLabel("lbledittheme", "Edit.lbledittheme")
                </div>
                <div class='buttons'>
                    <button id='createnew' type='button' class='btn btn-primary'><span class='glyphicon glyphicon-plus'></span>@ResourceKey("Edit.createnew")</button>
                    @DnnLabel("lblcreatenew", "Edit.lblcreatenew")
                </div>
            </div>

            <div id="step2" style="display: none;">

                <div id="newnamediv" style="display: none;">
                    @DnnLabel("lblnewname", "Edit.lblnewname")
                    @TextBox(info, "genxml/textbox/newname")
                </div>

                <div>
                    @DnnLabel("lblthemefolder", "Settings.themefolder")
                    @ThemeSelectList(info, "genxml/dropdownlist/themefolder", "/DesktopModules/NBright/NBrightMod/Themes", " ")
                </div>
                <hr />
                <div class='buttons'>
                    <button id='nextbutton' type='button' class='btn btn-success'><span class='glyphicon glyphicon-circle-arrow-right'></span>@ResourceKey("Edit.next")</button>
                </div>

            </div>
        </div>

        <div id="edittemplatediv"></div>

</div>

    <div id="thememsg"></div>

        <script>
            $(document).on("NBrightMod_nbxgetcompleted", NBrightMod_nbxgetCompleted); // assign a completed event for the ajax calls

            $(document).ready(function () {

                $('#nextbutton').click(function () {
                    $('#templfilename').val('view.cshtml'); // set default to view, shoudl always be there!
                    NBrightMod_nbxget('createtemplate', '#nbrightmodthemedata');
                });

                $('#edittheme').click(function () {
                    $('#updatetype').val('edit');
                    $('#step1').hide();
                    $('#step2').show();
                });
                $('#createnew').click(function () {
                    $('#updatetype').val('new');
                    $('#step1').hide();
                    $('#step2').show();
                    $('#newnamediv').show();
                });

                // copy of event in NBrightMod.js but not activated in there because we don;t load editdata.
                $('#exitedit').click(function () {
                    window.location.href = $('#exiturl').val();
                });


                $('#edittemplatediv').change(function () {
                    $('#optionselectdiv').hide();
                    $('#edittemplatediv').show();
                });

            });

            function NBrightMod_nbxgetCompleted(e) {

                if (e.cmd == 'createtemplate') {
                    NBrightMod_nbxget('gettemplatemenu', '#nbrightmodthemedata', '#edittemplatediv');
                }

                if (e.cmd == 'gettemplatemenu') {

                    $("#tabs").tabs({
                        activate: function (event, ui) {
                            $('#currentedittab').val(ui.newTab.index());
                        }
                        , active: $('#currentedittab').val()
                    });

                    $('.savedata').click(function () {
                        NBrightMod_nbxget('savetemplatedata', '#nbrightmodthemedata');
                    });

                    $('.selecteditlanguage').click(function () {
                        NBrightMod_nbxget('savetemplatedata', '#nbrightmodthemedata');
                        $('#editlang').val($(this).attr('lang')); // alter lang after, so we get correct data record
                    });
                    $('.selectfiletemplate').click(function () {
                        NBrightMod_nbxget('savetemplatedata', '#nbrightmodthemedata');
                        $('#templfilename').val($(this).attr('filename'));
                    });

                    /// START - DOCKING SCRIPT
                    var docked = 0;

                    $("#dock li ul").height($(window).height());

                    $("#dock .dock").click(function () {
                        $(this).parent().parent().addClass("docked").removeClass("free");

                        docked += 1;
                        var dockH = ($(window).height()) / docked
                        var dockT = 0;

                        $("#dock li ul.docked").each(function () {
                            $(this).height(dockH).css("top", dockT + "px");
                            dockT += dockH;
                        });
                        $(this).parent().find(".undock").show();
                        $(this).hide();

                        if (docked > 0)
                            $("#content").css("margin-left", "250px");
                        else
                            $("#content").css("margin-left", "60px");
                    });

                    $("#dock .undock").click(function () {
                        $(this).parent().parent().addClass("free").removeClass("docked")
                            .animate({ left: "-180px" }, 200).height($(window).height()).css("top", "0px");

                        docked = docked - 1;
                        var dockH = ($(window).height()) / docked
                        var dockT = 0;

                        $("#dock li ul.docked").each(function () {
                            $(this).height(dockH).css("top", dockT + "px");
                            dockT += dockH;
                        });
                        $(this).parent().find(".dock").show();
                        $(this).hide();

                        if (docked > 0)
                            $("#content").css("margin-left", "250px");
                        else
                            $("#content").css("margin-left", "60px");
                    });

                    $("#dock li").hover(function () {
                        $(this).find("ul").animate({ left: "40px" }, 200);
                    }, function () {
                        $(this).find("ul.free").animate({ left: "-180px" }, 200);
                    });
                    /// END - DOCKING SCRIPT


                }

                if (e.cmd == 'savetemplatedata') {
                    NBrightMod_nbxget('gettemplatemenu', '#nbrightmodthemedata', '#edittemplatediv');
                }

            };


        </script>
</div>

