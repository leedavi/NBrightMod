@inherits NBrightMod.render.NBrightModRazorTokens<NBrightDNN.NBrightRazor>
@using System.Linq
@using NBrightCore.common
@using NBrightDNN

@AddMetaData("resourcepath",GetTemplateRelPath("Theme.ascx.resx", Model, "resx").ToString())

@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightMod/App_LocalResources/")
@AddPreProcessMetaData("orderby", "ORDER BY NB1.XMLData.value('(genxml/hidden/sortrecordorder)[1]','int')", "Articles2.view.cshtml", Model.ModuleId.ToString(""))
@AddPreProcessMetaData("filter", " and ((NB1.XMLData.value('(genxml/textbox/startdate)[1]','nvarchar(10)') = '' or NB1.XMLData.value('(genxml/textbox/enddate)[1]','nvarchar(10)') = '') or (NB1.XMLData.value('(genxml/textbox/startdate)[1]','datetime') <= GETDATE() and NB1.XMLData.value('(genxml/textbox/enddate)[1]','datetime') >= GETDATE())) ", "Articles2.view.cshtml", Model.ModuleId.ToString(""))

<div class="articles">
@foreach (NBrightInfo info in Model.List)
{
var imageurl = info.GetXmlProperty("genxml/imgs/genxml[1]/hidden/imageurl");
<div class="article-item">
@if (Utils.IsDate(@info.GetXmlPropertyRaw("genxml/textbox/eventdate")))
    {
    var eventdate = Convert.ToDateTime(info.GetXmlPropertyRaw("genxml/textbox/eventdate"));
    <div class="formatdate">
      <span class="fd-day">@(eventdate.ToString("dd"))</span>
      <span class="fd-month">@(eventdate.ToString("MMM"))</span>
    </div>
    }
@if (imageurl != "")
    {
    var title = info.GetXmlProperty("genxml/lang/genxml/textbox/title");
    <div class="ai-img"><a href="@ResolveUrl("?eid=" + @info.ItemID)"><img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=820&h=360" alt="@(title)" /></a></div>
    }
<h2><a href="@ResolveUrl("?eid=" + @info.ItemID)">@info.GetXmlProperty("genxml/lang/genxml/textbox/title")</a></h2>
<p class="articleinfos"><span>@ResourceKey("Theme.published") </span>@info.GetXmlProperty("genxml/textbox/eventdate")<span> @ResourceKey("Theme.in") </span>@info.GetXmlProperty("genxml/lang/genxml/textbox/theme")</p>
<p>@BreakOf(info, "genxml/lang/genxml/textbox/summary")</p>
<a href="@ResolveUrl("?eid=" + @info.ItemID)" class="bigbutton">@ResourceKey("Theme.readmore")</a>
</div>
}
</div>