@inherits NBrightMod.render.NBrightModRazorTokens<NBrightDNN.NBrightRazor>
@using System
@using System.Linq
@using System.Xml
@using NBrightDNN

@AddMetaData("resourcepath","/DesktopModules/NBright/NBrightMod/Themes/SimpleArticles/resx/")
@AddMetaData("resourcepath", "/DesktopModules/NBright/NBrightMod/App_LocalResources/")
@AddPreProcessMetaData("orderby", "ORDER BY NB1.XMLData.value('(genxml/hidden/sortrecordorder)[1]','int')", "SimpleArticles.view.cshtml", Model.ModuleId.ToString(""))
@AddPreProcessMetaData("filter", " and ((NB1.XMLData.value('(genxml/textbox/startdate)[1]','nvarchar(10)') = '' or NB1.XMLData.value('(genxml/textbox/enddate)[1]','nvarchar(10)') = '') or (NB1.XMLData.value('(genxml/textbox/startdate)[1]','datetime') <= GETDATE() and NB1.XMLData.value('(genxml/textbox/enddate)[1]','datetime') >= GETDATE())) ", "SimpleArticles.view.cshtml", Model.ModuleId.ToString(""))


@helper imageindex(NBrightInfo x, String index)
{
var imageurl = x.GetXmlProperty("genxml/imgs/genxml[" + index + "]/hidden/imageurl");
var imgwidth = x.GetXmlProperty("genxml/imgs/genxml[" + index + "]/textbox/imgwidth");
var imgheight = x.GetXmlProperty("genxml/imgs/genxml[" + index + "]/textbox/imgheight");
var openinlightbox = x.GetXmlPropertyBool("genxml/checkbox/openinlightbox");
var caption = x.GetXmlProperty("genxml/lang/genxml/imgs/genxml[" + index + "]/textbox/imgcaption");

if (imageurl != "")
{
    if (openinlightbox)
    {
            <a class="fancybox" rel="group@(x.ItemID)" title="@(caption)" href="@(imageurl)">
                <img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=@(imgwidth)&h=@(imgheight)" alt="@(caption)" />
            </a>
    }
    else
    {
            <img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=@(imgwidth)&h=@(imgheight)" alt="@(caption)" />
    }
}
}

@helper imagedisplay(NBrightInfo x, String displaytype)
{
var imgList = x.XMLDoc.SelectNodes("genxml/imgs/genxml");
if (imgList != null)
{
    var openinlightbox = x.GetXmlPropertyBool("genxml/checkbox/openinlightbox");
    var c = 1;
    foreach (XmlNode i in imgList)
    {
        var nbi = new NBrightInfo();
        nbi.XMLData = i.OuterXml;
        var imageurl = nbi.GetXmlProperty("genxml/hidden/imageurl");
        var imgwidth = nbi.GetXmlProperty("genxml/textbox/imgwidth");
        var imgheight = nbi.GetXmlProperty("genxml/textbox/imgheight");
        var caption = x.GetXmlProperty("genxml/lang/genxml/imgs/genxml[" + c + "]/textbox/imgcaption");

        if (imageurl != "")
        {
            if ((displaytype == "vert") || ((c % 2 != 0) && displaytype == "odd") || ((c % 2 == 0) && displaytype == "even"))
            {
                if (openinlightbox)
                {
                        <a class="fancybox" rel="group@(x.ItemID)" title="@(caption)" href="@(imageurl)">
                            <img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=@(imgwidth)&h=@(imgheight)" alt="@(caption)" />
                        </a>
                    }
                    else
                    {
                        <img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=@(imgwidth)&h=@(imgheight)" alt="@(caption)" />
                    }
                }
                if (displaytype == "hoz")
                {
                    <div class="newspaper-imgdivfloatleft">
                        @if (openinlightbox)
                        {
                            <a class="fancybox" rel="group@(x.ItemID)" title="@(caption)" href="@(imageurl)">
                                <img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=@(imgwidth)&h=@(imgheight)" alt="@(caption)" />
                            </a>
                        }
                        else
                        {
                            <img src="/DesktopModules/NBright/NBrightData/NBrightThumb.ashx?src=@(imageurl)&w=@(imgwidth)&h=@(imgheight)" alt="@(caption)" />
                        }
                    </div>
            }
        }
        c += 1;

    }
}
}










@{
    var info = (NBrightInfo)Model.List.First();
}

<h1>@info.GetXmlProperty("genxml/lang/genxml/textbox/title")</h1>
<div class="simplearticles">
    
        <div class="simplearticlesdiv">
        <div class="simplearticlesleft">
        <p>
        @info.GetXmlProperty("genxml/textbox/eventdate")<br />
        @info.GetXmlProperty("genxml/lang/genxml/textbox/theme")
        </p>
        </div>
            <div class="simplearticlesright">
                <h2>@info.GetXmlProperty("genxml/lang/genxml/textbox/title")</h2>
                <p>@HtmlOf(info, "genxml/lang/genxml/textbox/infodesc")</p>
            </div>
            <div>
            </div>
            <div class="clearfix"></div>

            <div>@imageindex(info, "1")</div>

            <div>@imagedisplay(info, "vert")</div>
            
        </div>
    <div><a href="javascript:history.go(-1)">@ResourceKey("Edit.return")</a></div>
</div>